R1 = 8;  % пример
R2 = 9;
R3 = 3;
R4 = 7;
R5 = 15;
R6 = 11;

E1 = 140; % замените на ваше значение
E3 = 102; % замените на ваше значение


% Формирование матрицы A и вектора b для неизвестных [pa; pb; pc; pd]
A = zeros(4,4);
b = zeros(4,1);

% Уравнение (1): -pa/R2 - (pa-pb)/R6 - (pa-pc+E3)/R3 = 0
% => pa*(-1/R2 -1/R6 -1/R3) + pb*(1/R6) + pc*(1/R3) = E3/R3
A(1,1) = -1/R2 - 1/R6 - 1/R3;  % pa
A(1,2) =  1/R6;               % pb
A(1,3) =  1/R3;               % pc
A(1,4) =  0;                  % pd
b(1)   =  E3 / R3;

% Уравнение (2): (pa-pb)/R6 - (pb-pc)/R5 - (pb - E1)/R1 = 0
% => pa*(1/R6) + pb*(-1/R6 -1/R5 -1/R1) + pc*(1/R5) = -E1/R1
A(2,1) =  1/R6; 
A(2,2) = -1/R6 - 1/R5 - 1/R1;
A(2,3) =  1/R5;
A(2,4) =  0;
b(2)   = -E1 / R1;

% Уравнение (3): (pb-pc)/R5 + (pa-pc+E3)/R3 - (pc-pd)/R4 = 0
% => pa*(1/R3) + pb*(1/R5) + pc*(-1/R5 -1/R3 -1/R4) + pd*(1/R4) = -E3/R3
A(3,1) =  1/R3;
A(3,2) =  1/R5;
A(3,3) = -1/R5 - 1/R3 - 1/R4;
A(3,4) =  1/R4;
b(3)   = -E3 / R3;

% Дополнительное условие: заземление узла d (pd = 0)
A(4,1) = 0;
A(4,2) = 0;
A(4,3) = 0;
A(4,4) = 1;
b(4)   = 0;

% Проверка детерминанта (на случай вырождения)
if abs(det(A)) < 1e-12
    warning('Матрица A близка к вырожденной (det ~ 0). Проверьте входные данные и условия (например, заземление узла d).');
end

% Решение для па, пб, пц, пд
x = A \ b;   % x = [pa; pb; pc; pd]
pa = x(1); pb = x(2); pc = x(3); pd = x(4);

% Вычисление токов по заданным формулам
I3 = (pa - pc + E3) / R3;
I1 = (pb - E1) / R1;
I2 = (-pa) / R2;
I4 = (pc - pd) / R4;
I5 = (pb - pc) / R5;
I6 = (pa - pb) / R6;

% Вывод результатов
fprintf('Решение узловых потенциалов (V):\n');
fprintf('  pi(a) = %.6f V\n', pa);
fprintf('  pi(b) = %.6f V\n', pb);
fprintf('  pi(c) = %.6f V\n', pc);
fprintf('  pi(d) = %.6f V\n', pd);
fprintf('\nТоки (A):\n');
fprintf('  I1 = %.6f A\n', I1);
fprintf('  I2 = %.6f A\n', I2);
fprintf('  I3 = %.6f A\n', I3);
fprintf('  I4 = %.6f A\n', I4);
fprintf('  I5 = %.6f A\n', I5);
fprintf('  I6 = %.6f A\n', I6);

% Контроль: невязка исходных уравнений
% Пересчитаем левую часть трех уравнений I2 - I6 - I3, I6 - I5 - I1, I5 + I3 - I4
res1 = I2 - I6 - I3;
res2 = I6 - I5 - I1;
res3 = I5 + I3 - I4;
fprintf('\nНевязки уравнений (должны быть ~ 0): res1=%.2e, res2=%.2e, res3=%.2e\n', res1, res2, res3);
